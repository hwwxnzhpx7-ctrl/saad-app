<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>i-System Pro | الإدارة الذكية</title>
    
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css">
    
    <style>
        :root { --bg-dark: #0f1217; --card-bg: #1c2128; --accent: #ff6b35; }
        body { background-color: var(--bg-dark); color: white; font-family: 'Segoe UI', sans-serif; }
        .login-card { background: var(--card-bg); border-radius: 20px; padding: 40px; border: 1px solid #333; margin-top: 80px; }
        .form-control { background: #24292f !important; border: 1px solid #444 !important; color: white !important; border-radius: 12px; padding: 12px; }
        .btn-main { background: var(--accent); color: white; border: none; border-radius: 12px; padding: 15px; width: 100%; font-weight: bold; }
        #mainContent { display: none; padding: 20px; }
    </style>
</head>
<body>

<div id="loginPage" class="container">
    <div class="row justify-content-center">
        <div class="col-md-5 login-card text-center">
            <h3 class="mb-4">دخول i-System</h3>
            
            <div id="phone-box">
                <input type="text" id="phoneInput" class="form-control text-center fs-5 mb-3" placeholder="0534152055">
                <button onclick="sendOTP()" class="btn-main">إرسال رمز متغير</button>
                <div id="recaptcha-container" class="mt-3"></div>
            </div>

            <div id="otp-box" style="display:none;">
                <input type="text" id="otpInput" class="form-control text-center fs-2 mb-3" placeholder="••••••">
                <button onclick="verifyOTP()" class="btn-main">تأكيد الرمز</button>
            </div>
        </div>
    </div>
</div>

<div id="mainContent">
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h4>لوحة التحكم</h4>
        <button onclick="logout()" class="btn btn-outline-danger btn-sm">خروج</button>
    </div>
    <div class="alert alert-dark border-secondary">مرحباً بك.. جاري تحميل البيانات...</div>
</div>

<script>
    const firebaseConfig = {
        apiKey: "AIzaSyCsF-OsbE075c0lwhhcOj6GIHdUZAfCHCU",
        authDomain: "myinstallmentsystem.firebaseapp.com",
        projectId: "myinstallmentsystem",
        appId: "1:1073933519716:web:caac200c07e0356f81c871"
    };
    
    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();

    // إعداد الـ Recaptcha المرئي لضمان وصول الرسالة في السعودية
    window.recaptchaVerifier = new firebase.auth.RecaptchaVerifier('recaptcha-container', {
        'size': 'normal'
    });

    function sendOTP() {
        let num = document.getElementById('phoneInput').value.trim();
        if(num.startsWith('0')) num = '+966' + num.substring(1);
        
        auth.signInWithPhoneNumber(num, window.recaptchaVerifier)
            .then(result => {
                window.confirmationResult = result;
                document.getElementById('phone-box').style.display = 'none';
                document.getElementById('otp-box').style.display = 'block';
                alert("وصلت الرسالة؟ أدخل الرمز الآن.");
            }).catch(err => alert("خطأ: " + err.message));
    }

    function verifyOTP() {
        const code = document.getElementById('otpInput').value;
        window.confirmationResult.confirm(code).catch(() => alert("الرمز غير صحيح"));
    }

    auth.onAuthStateChanged(user => {
        if (user) {
            document.getElementById('loginPage').style.display = 'none';
            document.getElementById('mainContent').style.display = 'block';
        }
    });

    function logout() { auth.signOut().then(() => location.reload()); }
</script>
</body>
</html>
